# 森林冰火人

## 1. 项目概况

#### 1.1 项目背景

森林冰火人是一款经典且十分有趣的小游戏，非常考验玩家的操作敏捷程度与配合精神。在游戏中，玩家需要帮助森林中的水孩和火孩顺利过关，并收集所有的宝石。我们希望通过重新设计这款经典的游戏，让用户能够在体验到原版森林冰火人乐趣的同时，也能有一些新的惊喜。

#### 1.2 项目管理

- 版本控制：github
- 开发环境：QT 5.14.2
- 持续集成：appveyor
- 编程语言：C++17
- 框架结构：MVVM
- 文档编写：markdown

#### 1.3 小组信息

- 小组名称：森林冰火人组
- 小组成员：邱泽鸿，管元铭，李吉洋
- 选       题：森林冰火人小游戏



## 2. 详细功能说明

#### 2.1 功能列表

通过键盘实现冰娃与火娃的控制: 

- W: 冰娃的跳跃
- A: 冰娃的向左移动
- D: 冰娃的向右移动
- ↑: 火娃的跳跃
- ←: 火娃的向左移动
- →: 火娃的向右移动

#### 2.2 界面展示

![avatar](../src/view_demo.png)



#### 2.3 游戏目标

收集各种元素石头，躲避障碍，解开机关到达出口.

#### 2.4 游戏攻略

- 两个冰火人都不能接触与自己不同颜色的液体.
- 液体面积过大，角色无法通过时，寻找机关、石块，控制与液体同色的角色推动石块，在液体中铺路，让另一个冰火人通过.
- 某些地方的操作也是需要顺序的，首先要查看好地形.



## **3. 非功能性需求**

#### 3.1 系统需求

- 正确配置Qt后，所有系统都能编译执行.

#### 3.2 性能需求

- 尽量保证用户在进行游戏时不会出现卡顿等影响游戏体验的现象.
- 当前版本只支持单机游戏.



## 4. 项目规划

#### 4.1 框架描述

游戏采用MVVM (Model- View- ViewModel) 架构，主要由常量(common)、模型 (Model)、视图模型 (ViewModel)、视图 (View)、应用(App)层五部分组成，通过这五部分实现 UI 逻辑、呈现逻辑和状态控制、数据与业务逻辑的分离，实现了模块的独立开发。

##### Common

全局的宏定义、枚举类型。操作指令的基类定义，纯虚类`Commands`作为View中接口，纯虚函数`void exec()`作为指令的具体执行函数。

##### Model & View Model

操作实体的内部定义，内部逻辑的实现。实现碰撞检测、人物位置更新等等功能。在View Model中以command为基类派生具体的操作指令，命名为`功能_command`，通过模板类将具体command指令与View Model层相互绑定并且实现低耦合并行开发。在View Model层中定义`Exec_功能_command`函数作为指令响应时View Model向command提供的接口，command重载`void exec()`时调用`Exec_功能_command`函数。

##### View

从QMainWindow类派生出View类。处理界面反馈逻辑（键盘事件，定时器），以及绘制界面功能。用`command->exec()`的形式再接入Model&View Model层的功能。如果需要访问Model层的数据，在类内定义对应对应的仿函数。如`std::function<QPoint(void)> get_ice_pos`是获取冰人位置的仿函数，在App层再利用lambda表达式，绑定到Model & View Model层提供的访问接口上。

##### App

使用lambda表达式将View层的共享指针、仿函数绑定到Model&View Model上，向main函数提供程序执行的接口`void run()`函数。



#### 4.2 实现过程

**第一轮迭代**

- [x] 实现MVVM框架的搭建
- [x] 实现主窗口
- [x] 实现冰火人在地面上的移动控制
- [x] 完成基本的素材收集与设计，包括人物形象与背景音乐等

**第二轮迭代**

- [x] 完善地图界面（无机关）
- [x] 完善火人火人的UI
- [x] 完成冰火人和墙面的交互（碰撞检测与处理）

**第三轮迭代**

- [ ] 加入音效
- [ ] 加入冰潭、火潭
- [ ] 实现吃钻石加分的功能

**第四轮迭代**

- [ ] 加入开关
- [ ] 完成一些新关卡的设计





## 5. 小组分工

#### 第一轮迭代

邱泽鸿：View层 + App层，

管元铭：Model层 + ViewModel层

李吉洋：文档攥写 + 素材搜集

#### 第二轮迭代

邱泽鸿：Model层 + ViewModel层

管元铭：App层 + 文档攥写

李吉洋：View层

